import{r as o,o as _,N as f,E as G,I as O,v as d,e as p,m as n,Y as j,P as C,U as R,x as r,j as s,G as P,V as b,Z as u,W as B,F as M,J as N}from"./index-BZVQ2jPB.js";const z="http://127.0.0.1:8000/users/api/login",F="http://127.0.0.1:8000/users/api/register",J="http://127.0.0.1:8000/users/positions",Y="http://127.0.0.1:8000/users/department",W="http://127.0.0.1:8000/users/company";function Z(){const I=o(""),c=o(""),l=o(!1),a=o(""),v=o(""),m=o(""),g=o(""),w=o([]),h=o([]),k=o([]),U=o(null),V=o(null),x=o(null),S=async()=>{var e,t;if(!I.value||!c.value){a.value="Email и пароль обязательны!";return}l.value=!0,a.value="";try{const T=(await f.post(`${z}/`,{email:I.value,password:c.value})).data.token;return localStorage.setItem("authToken",T),console.log("token",localStorage),f.defaults.headers.common.Authorization=`Bearer ${T}`,!0}catch(i){a.value=((t=(e=i.response)==null?void 0:e.data)==null?void 0:t.message)||"Ошибка авторизации"}finally{l.value=!1}},A=async()=>{var e,t;if(!I.value||!v.value||!m.value||!c.value||!g.value||!U.value||!V.value||!x.value)return a.value="Пожалуйста заполните все поля",!1;l.value=!0,a.value="";try{const i=await f.post(`${F}/`,{email:I.value,first_name:v.value,last_name:m.value,password:c.value,phone_number:g.value,position:U.value,department:V.value,company:x.value});return!0}catch(i){return a.value=((t=(e=i.response)==null?void 0:e.data)==null?void 0:t.message)||"Ошибка при регистрации",!1}finally{l.value=!1}},$=()=>{localStorage.removeItem("authToken"),delete f.defaults.headers.common.Authorization,window.location.reload()},y=async()=>{try{const e=await f.get(`${J}/`);return console.log("Загрука список должностей",e.data),e.data}catch(e){return console.error("Ошибка при получении проекта:",e),null}},D=async()=>{try{const e=await f.get(`${Y}/`);return console.log("Загрука список отделов"),e.data}catch(e){return console.error("Ошибка при получении проекта:",e),null}},L=async()=>{try{return(await f.get(`${W}/`)).data}catch(e){return console.log("Ошибка загрузки данные о компании"),e}},E=async()=>{await handleLogin()?router.push({name:"Dashboard"}):a.value="Ошибка входа. Проверьте данные."};return _(async()=>{try{const[e,t,i]=await Promise.allSettled([y(),D(),L()]);e.status==="fulfilled"&&(w.value=e.value),t.status==="fulfilled"&&(h.value=t.value),i.status=="fulfilled"&&(k.value=i.value),console.log("Данные загружены:",{position:e.value,department:t.value,company:i.value})}catch(e){console.error("Ошибка при загрузке данных:",e)}}),{email:I,first_name:v,last_name:m,phone_number:g,password:c,isLoading:l,position:w,company:k,department:h,handleLoginClick:E,register:A,login:S,logout:$,errorMessage:a,selectedPosition:U,selectedDepartment:V,selectedCompany:x,getDepartment:D,getCompany:L,getPosition:y}}const q={class:"container",id:"container"},H={class:"form-container sign-up-container"},K={key:0,class:"errormes"},Q={style:{display:"flex","justify-content":"space-around"}},X={style:{display:"flex","justify-content":"space-around"}},ee=["value"],te=["value"],ne=["value"],se=["disabled"],ae={class:"form-container sign-in-container"},le=["disabled"],oe={key:0,class:"errormes"},re={__name:"signup",setup(I){const c=O(),{email:l,password:a,first_name:v,last_name:m,selectedPosition:g,selectedDepartment:w,selectedCompany:h,phone_number:k,isLoading:U,position:V,department:x,company:S,login:A,register:$,errorMessage:y}=Z(),D=async()=>{y.value="",await $()&&c.push({name:"Dashboard"})},L=async()=>{await A()&&c.push({name:"Chat"})};return _(()=>{const E=document.getElementById("signUp"),e=document.getElementById("signIn"),t=document.getElementById("container");E.addEventListener("click",()=>{t.classList.add("right-panel-active")}),e.addEventListener("click",()=>{t.classList.remove("right-panel-active")})}),(E,e)=>(p(),d("div",null,[n("div",q,[n("div",H,[n("form",{onSubmit:C(D,["prevent"])},[s(y)?(p(),d("p",K,P(s(y)),1)):R("",!0),n("div",Q,[r(n("input",{type:"email",placeholder:"Email","onUpdate:modelValue":e[0]||(e[0]=t=>u(l)?l.value=t:null),onInput:e[1]||(e[1]=t=>console.log("email:",s(l)))},null,544),[[b,s(l)]]),r(n("input",{type:"text",placeholder:"Имя","onUpdate:modelValue":e[2]||(e[2]=t=>u(v)?v.value=t:null),onInput:e[3]||(e[3]=t=>console.log("first name:",s(v)))},null,544),[[b,s(v)]])]),r(n("input",{type:"text",placeholder:"Фамилия","onUpdate:modelValue":e[4]||(e[4]=t=>u(m)?m.value=t:null),onInput:e[5]||(e[5]=t=>console.log("last name:",s(m)))},null,544),[[b,s(m)]]),n("div",X,[r(n("input",{type:"password",placeholder:"Password","onUpdate:modelValue":e[6]||(e[6]=t=>u(a)?a.value=t:null),onInput:e[7]||(e[7]=t=>console.log("password:",s(a)))},null,544),[[b,s(a)]]),r(n("input",{type:"text",inputmode:"numeric",pattern:"[0-9]*","onUpdate:modelValue":e[8]||(e[8]=t=>u(k)?k.value=t:null),placeholder:"Номер телефона"},null,512),[[b,s(k)]])]),e[14]||(e[14]=n("label",{class:"label-name"},"Должность",-1)),r(n("select",{"onUpdate:modelValue":e[9]||(e[9]=t=>u(g)?g.value=t:null)},[(p(!0),d(M,null,N(s(V),t=>(p(),d("option",{key:t.id,value:t.id},P(t.position_name),9,ee))),128))],512),[[B,s(g)]]),e[15]||(e[15]=n("br",null,null,-1)),e[16]||(e[16]=n("label",{class:"label-name"},"Отдел",-1)),r(n("select",{"onUpdate:modelValue":e[10]||(e[10]=t=>u(w)?w.value=t:null)},[(p(!0),d(M,null,N(s(x),t=>(p(),d("option",{key:t.id,value:t.id},P(t.department_name)+" ("+P(t.department_head)+") ",9,te))),128))],512),[[B,s(w)]]),e[17]||(e[17]=n("br",null,null,-1)),e[18]||(e[18]=n("label",{class:"label-name"},"Организация",-1)),r(n("select",{"onUpdate:modelValue":e[11]||(e[11]=t=>u(h)?h.value=t:null)},[(p(!0),d(M,null,N(s(S),t=>(p(),d("option",{key:t.id,value:t.id},P(t.company_name),9,ne))),128))],512),[[B,s(h)]]),e[19]||(e[19]=n("br",null,null,-1)),n("button",{type:"submit",disabled:s(U)}," Создать Аккаунт ",8,se)],32)]),n("div",ae,[n("form",{onSubmit:C(L,["prevent"])},[e[20]||(e[20]=n("h1",null,"Войти в Аккаунт",-1)),e[21]||(e[21]=n("br",null,null,-1)),r(n("input",{type:"email",placeholder:"Email","onUpdate:modelValue":e[12]||(e[12]=t=>u(l)?l.value=t:null)},null,512),[[b,s(l)]]),r(n("input",{type:"password",placeholder:"Пароль","onUpdate:modelValue":e[13]||(e[13]=t=>u(a)?a.value=t:null)},null,512),[[b,s(a)]]),e[22]||(e[22]=n("a",{href:"#"},"Забыли Пароль?",-1)),n("button",{type:"submit",disabled:s(U)},"Войти",8,le),s(y)?(p(),d("p",oe,P(s(y)),1)):R("",!0)],32)]),e[23]||(e[23]=j('<div class="overlay-container" data-v-524d55cc><div class="overlay" data-v-524d55cc><div class="overlay-panel overlay-left" data-v-524d55cc><h1 data-v-524d55cc>Аккаунт уже имеется?</h1><br data-v-524d55cc><button class="ghost" id="signIn" data-v-524d55cc>Войти</button></div><div class="overlay-panel overlay-right" data-v-524d55cc><h1 data-v-524d55cc>GuideJet TI!</h1><br data-v-524d55cc><button class="ghost" id="signUp" data-v-524d55cc>Регистрация</button></div></div></div>',1))])]))}},ie=G(re,[["__scopeId","data-v-524d55cc"]]);export{ie as default};
