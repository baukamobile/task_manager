import{a as s}from"./index-C88pvD_q.js";import{r as t,o as A}from"./index-DgFySzYa.js";const k="http://127.0.0.1:8000/users/api/login",D="http://127.0.0.1:8000/users/api/register",S="http://127.0.0.1:8000/users/positions",T="http://127.0.0.1:8000/users/department";function L(){const n=t(""),r=t(""),l=t(!1),o=t(""),c=t(""),i=t(""),p=t(""),d=t([]),f=t([]),v=t(null),m=t(null),w=async()=>{var e,a;if(!n.value||!r.value){o.value="Email и пароль обязательны!";return}l.value=!0,o.value="";try{const y=(await s.post(`${k}/`,{email:n.value,password:r.value})).data.token;return localStorage.setItem("authToken",y),console.log("token",localStorage),s.defaults.headers.common.Authorization=`Bearer ${y}`,!0}catch(u){o.value=((a=(e=u.response)==null?void 0:e.data)==null?void 0:a.message)||"Ошибка авторизации"}finally{l.value=!1}},I=async()=>{var e,a;if(!n.value||!c.value||!i.value||!r.value||!p.value||!v.value||!m.value)return o.value="Пожалуйста заполните все поля",!1;l.value=!0,o.value="";try{const u=await s.post(`${D}/`,{email:n.value,first_name:c.value,last_name:i.value,password:r.value,phone_number:p.value,position:v.value,department:m.value});return!0}catch(u){return o.value=((a=(e=u.response)==null?void 0:e.data)==null?void 0:a.message)||"Ошибка при регистрации",!1}finally{l.value=!1}},_=()=>{localStorage.removeItem("authToken"),delete s.defaults.headers.common.Authorization,window.location.reload()},g=async()=>{try{const e=await s.get(`${S}/`);return console.log("Загрука список должностей",e.data),e.data}catch(e){return console.error("Ошибка при получении проекта:",e),null}},h=async()=>{try{const e=await s.get(`${T}/`);return console.log("Загрука список отделов"),e.data}catch(e){return console.error("Ошибка при получении проекта:",e),null}},P=async()=>{await handleLogin()?router.push({name:"Dashboard"}):o.value="Ошибка входа. Проверьте данные."};return A(async()=>{try{const[e,a]=await Promise.allSettled([g(),h()]);e.status==="fulfilled"&&(d.value=e.value),a.status==="fulfilled"&&(f.value=a.value),console.log("Данные загружены:",{position:e.value,department:a.value})}catch(e){console.error("Ошибка при загрузке данных:",e)}}),{email:n,first_name:c,last_name:i,phone_number:p,password:r,isLoading:l,position:d,department:f,handleLoginClick:P,register:I,login:w,logout:_,errorMessage:o,selectedPosition:v,selectedDepartment:m,getDepartment:h,getPosition:g}}export{L as U};
