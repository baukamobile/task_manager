import{_ as Q}from"./PageWrapper-DTMdDcJF.js";import{b as j,c as S,g as W,d as G,u as X}from"./tasks-BvUq67hy.js";import{g as _,R as A,r as d,M as P,o as L,t as f,b as Y,e as g,f as Z,m as c,y as h,F as x,Q as I,j as m,D as $,E as v}from"./index-BlCUlzV6.js";import{C as K}from"./CommentOutlined-puv2g38Z.js";var ee={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M923 283.6a260.04 260.04 0 00-56.9-82.8 264.4 264.4 0 00-84-55.5A265.34 265.34 0 00679.7 125c-49.3 0-97.4 13.5-139.2 39-10 6.1-19.5 12.8-28.5 20.1-9-7.3-18.5-14-28.5-20.1-41.8-25.5-89.9-39-139.2-39-35.5 0-69.9 6.8-102.4 20.3-31.4 13-59.7 31.7-84 55.5a258.44 258.44 0 00-56.9 82.8c-13.9 32.3-21 66.6-21 101.9 0 33.3 6.8 68 20.3 103.3 11.3 29.5 27.5 60.1 48.2 91 32.8 48.9 77.9 99.9 133.9 151.6 92.8 85.7 184.7 144.9 188.6 147.3l23.7 15.2c10.5 6.7 24 6.7 34.5 0l23.7-15.2c3.9-2.5 95.7-61.6 188.6-147.3 56-51.7 101.1-102.7 133.9-151.6 20.7-30.9 37-61.5 48.2-91 13.5-35.3 20.3-70 20.3-103.3.1-35.3-7-69.6-20.9-101.9zM512 814.8S156 586.7 156 385.5C156 283.6 240.3 201 344.3 201c73.1 0 136.5 40.8 167.7 100.4C543.2 241.8 606.6 201 679.7 201c104 0 188.3 82.6 188.3 184.5 0 201.2-356 429.3-356 429.3z"}}]},name:"heart",theme:"outlined"};function C(t){for(var a=1;a<arguments.length;a++){var s=arguments[a]!=null?Object(arguments[a]):{},l=Object.keys(s);typeof Object.getOwnPropertySymbols=="function"&&(l=l.concat(Object.getOwnPropertySymbols(s).filter(function(n){return Object.getOwnPropertyDescriptor(s,n).enumerable}))),l.forEach(function(n){te(t,n,s[n])})}return t}function te(t,a,s){return a in t?Object.defineProperty(t,a,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[a]=s,t}var k=function(a,s){var l=C({},a,s.attrs);return _(A,C({},l,{icon:ee}),null)};k.displayName="HeartOutlined";k.inheritAttrs=!1;var re={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M885.9 533.7c16.8-22.2 26.1-49.4 26.1-77.7 0-44.9-25.1-87.4-65.5-111.1a67.67 67.67 0 00-34.3-9.3H572.4l6-122.9c1.4-29.7-9.1-57.9-29.5-79.4A106.62 106.62 0 00471 99.9c-52 0-98 35-111.8 85.1l-85.9 311H144c-17.7 0-32 14.3-32 32v364c0 17.7 14.3 32 32 32h601.3c9.2 0 18.2-1.8 26.5-5.4 47.6-20.3 78.3-66.8 78.3-118.4 0-12.6-1.8-25-5.4-37 16.8-22.2 26.1-49.4 26.1-77.7 0-12.6-1.8-25-5.4-37 16.8-22.2 26.1-49.4 26.1-77.7-.2-12.6-2-25.1-5.6-37.1zM184 852V568h81v284h-81zm636.4-353l-21.9 19 13.9 25.4a56.2 56.2 0 016.9 27.3c0 16.5-7.2 32.2-19.6 43l-21.9 19 13.9 25.4a56.2 56.2 0 016.9 27.3c0 16.5-7.2 32.2-19.6 43l-21.9 19 13.9 25.4a56.2 56.2 0 016.9 27.3c0 22.4-13.2 42.6-33.6 51.8H329V564.8l99.5-360.5a44.1 44.1 0 0142.2-32.3c7.6 0 15.1 2.2 21.1 6.7 9.9 7.4 15.2 18.6 14.6 30.5l-9.6 198.4h314.4C829 418.5 840 436.9 840 456c0 16.5-7.2 32.1-19.6 43z"}}]},name:"like",theme:"outlined"};function N(t){for(var a=1;a<arguments.length;a++){var s=arguments[a]!=null?Object(arguments[a]):{},l=Object.keys(s);typeof Object.getOwnPropertySymbols=="function"&&(l=l.concat(Object.getOwnPropertySymbols(s).filter(function(n){return Object.getOwnPropertyDescriptor(s,n).enumerable}))),l.forEach(function(n){ae(t,n,s[n])})}return t}function ae(t,a,s){return a in t?Object.defineProperty(t,a,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[a]=s,t}var D=function(a,s){var l=N({},a,s.attrs);return _(A,N({},l,{icon:re}),null)};D.displayName="LikeOutlined";D.inheritAttrs=!1;const O="http://127.0.0.1:8000/tasks/tasks",ne="http://127.0.0.1:8000/tasks/status",oe="http://127.0.0.1:8000/tasks/projects",se=async()=>{try{const t=await f.get(`${oe}/`);return console.log("Загрука проектов"),t.data}catch(t){return console.error("Ошибка при получении проекта:",t),null}};function le(){const t=d([]),a=d({}),s=d([]),l=d({status_name:"",user:null}),n=d([]);P({project_name:"",description:"",department:null,assigned:null,end_date:""});const r=P({task_name:"",description:"",documents:null,end_date:"",agreed_with_managers:!1,assigned:14,status:1,priority:1,projects:2,department:1}),b={1:{priority_name:"НИЗКИЙ",color:"green"},2:{priority_name:"СРЕДНИЙ",color:"blue"},3:{priority_name:"ВЫСОКИЙ",color:"orange"},4:{priority_name:"КРИТИЧЕСКИЙ",color:"red"}},w=async e=>{try{await f.delete(`${ne}/${e}/`),console.log("Удаление колонок"),n.value=n.value.filter(o=>o.id!==e)}catch(o){console.error("Ошибка удаления колонки",o)}},E=async e=>{try{await f.delete(`${O}/${e}/`),t.value=t.value.filter(o=>o.id!==e),console.log("Удаление задач")}catch(o){console.error("Ошибка удаления задачи",o)}};function M(e,o){console.log("Перетаскивание задач"),e.dataTransfer.dropEffect="move",e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("taskID",o.id.toString())}async function B(e,o){e.preventDefault();const u=parseInt(e.dataTransfer.getData("taskID"));try{await X(u,o);const i=t.value.find(y=>y.id===u);i&&(i.status=o)}catch(i){console.error("Ошибка при обновлении задачи:",i)}}function F(e){const o=new Date(e);return e?o.toLocaleString("ru-RU",{day:"2-digit",month:"long",hour:"2-digit",minute:"2-digit"}):"Нет даты"}function T(e){if(!e)return null;const o=new Date(e);return isNaN(o)?(console.error("Неправильная дата:",e),null):o.toISOString().split("T")[0]}const H=async()=>{try{if(console.log(" Тип end_date:",typeof r.end_date),!l.value.user){console.error("Ошибка: user не выбран!");return}await G(l.value),l.value.status_name="",l.value.user=null,n.value=await S()}catch(e){console.error("Ошибка при добавлении колонки",e)}},R=async()=>{var e;try{if(console.log("Перед отправкой:",JSON.stringify(r,null,2)),r.end_date=T(r.end_date),!r||!((e=r.task_name)!=null&&e.trim())){console.error("Ошибка: Задание должно быть заполненным");return}if(!r.projects){alert("Выберите проект");return}console.log("Попытка отправки запроса...",JSON.stringify(r,null,2));const o=await f.post(`${O}/`,r);console.log("Ответ сервера:",o.data),t.value.length=0,t.value.push(...await j()),console.log("НОВАЯ ЗАДАЧА",t.value),Object.assign(r,{task_name:"",description:"",documents:null,end_date:"",agreed_with_managers:!1,projects:null,assigned:null,status:1,priority:1})}catch(o){console.error("Ошибка при добавлении задания",o)}},U=e=>{r.value={...e},r.task_name=e.task_name,r.description=e.description,r.documents=e.documents,r.end_date=e.end_date,r.assigned=e.assigned,r.agreed_with_managers=e.agreed_with_managers,r.status=e.status,r.priority=e.priority,r.projects=e.projects,showTaskForm.value={...showTaskForm.value,[e.status]:!0}},z=async()=>{try{if(!r.value.id){console.error("Нет ID задачи для обновления");return}console.log("Отправка обновления задачи:",JSON.stringify(r.value,null,2));const e=await f.patch(`${O}/${r.value.id}/`,r.value);console.log("Ответ сервера:",e.data),t.value=await j(),showTaskForm.value={...showTaskForm.value,[task.status]:!0}}catch(e){console.error("Ошибка при обновлении задачи",e)}};function V(e,o){e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("statusID",o.id.toString()),console.log("Перетаскивание колонок: ",o)}const J=(e,o)=>{const u=e.dataTransfer.getData("statusId");if(u&&u!==o.id){const i=n.findIndex(p=>p.id==u),y=n.findIndex(p=>p.id==o.id);if(i!==-1&&y!==-1){const p=n[i];n.splice(i,1),n.splice(y,0,p)}}};function q(e){e.preventDefault()}return L(async()=>{try{const[e,o,u,i]=await Promise.allSettled([j(),S(),W(),se()]);e.status==="fulfilled"&&(t.value=e.value),o.status==="fulfilled"&&(n.value=o.value),u.status==="fulfilled"&&(s.value=u.value),i.status==="fulfilled"&&(a.value=i.value),console.log("Данные загружены:",{tasks:t.value,statuses:n.value,users:s.value,projects:a.value})}catch(e){console.error("Ошибка при загрузке данных:",e)}}),{tasks:t,statuses:n,projects:a,users:s,newStatus:l,newTask:r,priority:b,updateTask:z,editTask:U,handleClick:w,handleClickTask:E,ondragstart:M,onDrop:B,formatDate:F,formatDateForBackend:T,submitColumn:H,submitTask:R,onColumnDrag:V,onColumnDrop:J,onColumnDragOver:q}}const ce="http://127.0.0.1:8000/news/news",ie=async()=>{try{const t=await f.get(`${ce}/`);return console.log("Загрузка новостей"),t.data}catch(t){return console.error("Ошибка при получении новостей:",t),null}};function ue(){const t=d([]);return L(async()=>{try{const a=await ie();a&&(t.value=a,console.log("Новости загружены:",t.value))}catch(a){console.error("Ошибка загрузки news",a)}}),{news:t}}const de={class:"projcard-container"},fe={class:"projcard-innerbox"},pe=["src"],ge={class:"projcard-textbox"},me={class:"projcard-subtitle"},ve={style:{"font-weight":"100"}},_e={class:"projcard-description"},ye={style:{display:"flex","justify-content":"space-evenly"}},he={class:"projcard-tagbox"},ke={__name:"news",setup(t){document.querySelectorAll(".projcard-description").forEach(function(l){$clamp(l,{clamp:6})});const{formatDate:a}=le(),{news:s}=ue();return console.log("Теги новости:",s.tags,typeof s.tags),(l,n)=>(g(),Y(Q,null,{header:Z(()=>[c("div",de,[(g(!0),h(x,null,I(m(s),r=>(g(),h("div",{class:"projcard projcard-blue",key:r.id},[c("div",fe,[c("img",{class:"projcard-img",src:r.picture},null,8,pe),c("div",ge,[c("div",me,[$(v(r.title)+" ",1),c("p",ve," Опубликован: "+v(m(a)(r.created_at))+" Автор: "+v(r.created_by),1)]),n[3]||(n[3]=c("div",{class:"projcard-bar"},null,-1)),c("div",_e,v(r.content),1),c("div",ye,[_(m(k),{style:{color:"red"}}),n[0]||(n[0]=$()),n[1]||(n[1]=c("br",null,null,-1)),_(m(D),{style:{color:"blue"}}),n[2]||(n[2]=c("br",null,null,-1)),_(m(K),{style:{color:"green"}})]),c("div",he,[(g(!0),h(x,null,I(r.tags,(b,w)=>(g(),h("a",{key:w,href:"#",class:"projcard-tag"},v(b.name),1))),128))])])])]))),128))])]),_:1}))}};export{ke as default};
