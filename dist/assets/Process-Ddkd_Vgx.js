import{K as j,r as m,M as B,o as F,q as x,b as A,e as a,f as P,m as s,y as r,N as L,O as z,z as u,P as h,F as p,Q as _,E as l,$ as C,j as v,D as M,g as V,t as D}from"./index-BlCUlzV6.js";import{_ as I}from"./PageWrapper-DTMdDcJF.js";import{P as O}from"./getProcess-DZbhXZ0e.js";import{u as q}from"./useTaskManger-CPlC2F5C.js";import{e as K}from"./tasks-BvUq67hy.js";const Q={class:"ag-format-container"},G={key:0,class:"project-form-container"},H={class:"project-form"},J={class:"form-group"},W={class:"form-group"},X={class:"form-group"},Y=["value"],Z={class:"form-group"},ee=["value"],se={class:"process-container"},te=["onClick"],oe={class:"ag-courses-item_link"},ne={class:"ag-courses-item_title"},ae={class:"ag-courses-item_title2"},re={style:{color:"aliceblue","z-index":"5"}},le={class:"ag-courses-item_date-box"},ie={class:"ag-courses-item_date"},de={class:"ag-courses-item_date"},ge={__name:"Process",setup(ce){const U="http://127.0.0.1:8000/users/users",N="http://127.0.0.1:8000/users/department",{processes:S}=O(),T=j(),i=m(!1),f=m([]),g=m([]),E=n=>{T.push({name:"Processtasks",params:{processId:n}})},o=B({template:null,name:"",description:"",owner:null,department:null,bpmn_xml:null,is_complete:!1,is_recurring:!1,recurring_interval:null}),{formatDate:w}=q(),y=()=>{i.value=!i.value,i.value&&(b(),k())},b=async()=>{try{const n=await D.get(`${N}/`);f.value=n.data}catch(n){console.error("Ошибка при загрузке отделов:",n)}},k=async()=>{try{const n=await D.get(`${U}/`);g.value=n.data}catch(n){console.error("Ошибка при загрузке пользователей:",n)}},R=async()=>{var e,d;if(console.log("newProcess:",o),!o.name){alert("Введите название процесса");return}if(!o.department){alert("Выберите отдел");return}const n={...o,department:((e=o.department)==null?void 0:e.id)||o.department,owner:((d=o.owner)==null?void 0:d.id)||o.owner};try{await K(n),o.name="",o.description="",o.department=null,o.owner=null,i.value=!1}catch(c){console.error("Ошибка:",c),alert("Ошибка при сохранении процесса: "+(c.message||"Неизвестная ошибка"))}};return F(()=>{b(),k()}),(n,e)=>{const d=x("Search"),c=x("el-icon");return a(),A(I,null,{default:P(()=>[s("div",Q,[s("a",{href:"#",onClick:z(y,["prevent"])},e[4]||(e[4]=[s("h1",{class:"text-xl font-semibold leading-tight",style:{display:"flex","justify-content":"right",padding:"10px"}},"Добавить Процесс + ",-1)])),i.value?(a(),r("div",G,[s("div",H,[e[11]||(e[11]=s("h2",{class:"form-title"},"Новый процесс",-1)),s("div",J,[e[5]||(e[5]=s("label",null,"Название процесса",-1)),u(s("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>o.name=t),type:"text",placeholder:"Введите название процесса"},null,512),[[h,o.name]])]),s("div",W,[e[6]||(e[6]=s("label",null,"Описание",-1)),u(s("textarea",{"onUpdate:modelValue":e[1]||(e[1]=t=>o.description=t),placeholder:"Введите описание процесса"},null,512),[[h,o.description]])]),s("div",X,[e[8]||(e[8]=s("label",null,"Отдел",-1)),u(s("select",{"onUpdate:modelValue":e[2]||(e[2]=t=>o.department=t)},[e[7]||(e[7]=s("option",{value:"",disabled:"",selected:""},"Выберите отдел",-1)),(a(!0),r(p,null,_(f.value,t=>(a(),r("option",{key:t.id,value:t.id},l(t.department_name),9,Y))),128))],512),[[C,o.department]])]),s("div",Z,[e[10]||(e[10]=s("label",null,"Владелец процесса",-1)),u(s("select",{"onUpdate:modelValue":e[3]||(e[3]=t=>o.owner=t)},[e[9]||(e[9]=s("option",{value:"",disabled:"",selected:""},"Выберите владельца",-1)),(a(!0),r(p,null,_(g.value,t=>(a(),r("option",{key:t.id,value:t.id},l(t.first_name)+" "+l(t.last_name||t.username),9,ee))),128))],512),[[C,o.owner]])]),s("div",{class:"form-actions"},[s("button",{onClick:R,class:"save-btn"},"Сохранить"),s("button",{onClick:y,class:"cancel-btn"},"Отмена")])])])):L("",!0)]),s("div",se,[(a(!0),r(p,null,_(v(S),(t,$)=>(a(),r("div",{key:$},[s("div",{class:"ag-courses_item",onClick:ue=>E(t.id)},[s("div",oe,[e[14]||(e[14]=s("div",{class:"ag-courses-item_bg"},null,-1)),s("div",ne," Процесс: "+l(t.name),1),s("div",ae,[s("p",re,l(t.description),1)]),s("div",le,[e[12]||(e[12]=M(" Начало: ")),s("span",ie,l(v(w)(t.created_at)),1),e[13]||(e[13]=M(" Конец: ")),s("span",de,l(v(w)(t.updated_at)),1),V(c,null,{default:P(()=>[V(d)]),_:1})])])],8,te)]))),128))])]),_:1})}}};export{ge as default};
